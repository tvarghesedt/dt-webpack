var Handlebars = require('./handlebars-1.0.0.min.js');
console.log(Handlebars);
!function(a){a.fn.storeLocator=function(b){var c=a.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:4,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:60,distanceAlert:-1,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:!1,originpinColor:"blue",bounceMarker:!0,slideMap:!0,modalWindow:!1,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:!1,defaultLat:"",defaultLng:"",autoGeocode:!1,maxDistance:!1,maxDistanceID:"maxdistance",fullMapStart:!1,noForm:!1,loading:!1,loadingDiv:"loading-map",featuredLocations:!1,infowindowTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/xml-infowindow-description.html",listTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/xml-location-list-description.html",KMLinfowindowTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/kml-infowindow-description.html",KMLlistTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers"},b);return this.each(function(){function f(){"kml"===c.dataType?(a.get(c.KMLinfowindowTemplatePath,function(a){var b=a;e=Handlebars.compile(b)}),a.get(c.KMLlistTemplatePath,function(a){var b=a;d=Handlebars.compile(b),g()})):(a.get(c.infowindowTemplatePath,function(a){var b=a;e=Handlebars.compile(b)}),a.get(c.listTemplatePath,function(a){var b=a;d=Handlebars.compile(b),g()}))}function g(){function q(){l=[],m=[],n=[],o=[],a(document).off("click."+p,"#"+c.listDiv+" li")}function s(){if(c.defaultLoc===!0){var a=new u,b=new google.maps.LatLng(c.defaultLat,c.defaultLng);a.geocode(b,function(a){if(null!==a){var b=a.address;z(c.defaultLat,c.defaultLng,b)}else alert(c.addressErrorAlert)})}c.fullMapStart===!0&&z(),c.autoGeocode===!0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(w,x)}function t(){geocoder=new google.maps.Geocoder,this.geocode=function(a,b){geocoder.geocode({address:a},function(a,d){if(d===google.maps.GeocoderStatus.OK){var e={};e.latitude=a[0].geometry.location.lat(),e.longitude=a[0].geometry.location.lng(),b(e)}else alert(c.geocodeErrorAlert+d),b(null)})}}function u(){geocoder=new google.maps.Geocoder,this.geocode=function(a,b){geocoder.geocode({latLng:a},function(a,d){if(d===google.maps.GeocoderStatus.OK){if(a[0]){var e={};e.address=a[0].formatted_address,b(e)}}else alert(c.geocodeErrorAlert+d),b(null)})}}function v(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b)}function w(a){var b=new u,d=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);b.geocode(d,function(b){if(null!==b){var d=b.address;z(a.coords.latitude,a.coords.longitude,d)}else alert(c.addressErrorAlert)})}function x(a){alert(c.autoGeocodeErrorAlert)}function y(b){var d=a("#"+c.inputID).val();if(""===d)s();else{var e=new t,f=d;e.geocode(f,function(a){null!==a?(g=a.latitude,h=a.longitude,z(g,h,d,b)):alert(c.addressErrorAlert)})}}function z(f,g,h,i){a(function(){google.maps.visualRefresh=!0;var j;j="kml"===c.dataType?"xml":c.dataType,a.ajax({type:"GET",url:c.dataLocation+("jsonp"===c.dataType?(c.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:j,jsonpCallback:"jsonp"===c.dataType?c.jsonpCallback:null,beforeSend:function(){c.callbackBeforeSend&&c.callbackBeforeSend.call(this),c.loading===!0&&a("#"+c.formContainerDiv).append('<div id="'+c.loadingDiv+'"></div>')},complete:function(b,d,e){c.callbackComplete&&c.callbackComplete.call(this,b,d,e),c.loading===!0&&a("#"+c.loadingDiv).remove()},success:function(j,s,t){function x(a){a.sort(function(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0})}c.callbackSuccess&&c.callbackSuccess.call(this,j,s,t);var w,u=0;c.fullMapStart===!0&&a("#"+c.mapDiv).hasClass("mapOpen")===!1?w=!0:q(),a("#"+c.mapDiv).addClass("mapOpen"),"json"===c.dataType||"jsonp"===c.dataType?a.each(j,function(){var a,b,d={};for(a in this)b=this[a],"web"===a&&b&&(b=b.replace("http://","")),d[a]=b;if(d.distance||(d.distance=r.CalcDistance(f,g,d.lat,d.lng,r.EarthRadius)),c.maxDistance===!0&&w!==!0&&i){if(!(d.distance<i))return;l[u]=d}else l[u]=d;u++}):"kml"===c.dataType?a(j).find("Placemark").each(function(){var b={name:a(this).find("name").text(),lat:a(this).find("coordinates").text().split(",")[1],lng:a(this).find("coordinates").text().split(",")[0],description:a(this).find("description").text()};if(b.distance=r.CalcDistance(f,g,b.lat,b.lng,r.EarthRadius),c.maxDistance===!0&&w!==!0&&i){if(!(b.distance<i))return;l[u]=b}else l[u]=b;u++}):a(j).find("marker").each(function(){var b={name:a(this).attr("name"),lat:a(this).attr("lat"),lng:a(this).attr("lng"),address:a(this).attr("address"),address2:a(this).attr("address2"),city:a(this).attr("city"),state:a(this).attr("state"),postal:a(this).attr("postal"),country:a(this).attr("country"),phone:a(this).attr("phone"),email:a(this).attr("email"),web:a(this).attr("web"),hours1:a(this).attr("hours1"),hours2:a(this).attr("hours2"),hours3:a(this).attr("hours3"),category:a(this).attr("category"),featured:a(this).attr("featured")};if(b.web&&(b.web=b.web.replace("http://","")),b.distance=r.CalcDistance(f,g,b.lat,b.lng,r.EarthRadius),c.maxDistance===!0&&w!==!0&&i){if(!(b.distance<i))return;l[u]=b}else l[u]=b;u++}),x(l),c.featuredLocations===!0&&(m=a.grep(l,function(a,b){return"true"===a.featured}),n=a.grep(l,function(a,b){return"true"!==a.featured}),l=[],l=m.concat(n));var y="km"===c.lengthUnit?c.kilometersLang:c.milesLang;if(c.maxDistance===!0&&w!==!0&&i){if(void 0===l[0]||l[0].distance>i)return void alert(c.distanceErrorAlert+i+" "+y)}else c.distanceAlert!==-1&&l[0].distance>c.distanceAlert&&alert(c.distanceErrorAlert+c.distanceAlert+" "+y);a(function(){function n(a){for(i in l[a])j=l[a][i],"distance"===i&&(j=v(j,2)),m[i]=j}function q(b){n(b.get("id"));var d;d=m.distance<=1?"km"===c.lengthUnit?c.kilometerLang:c.mileLang:"km"===c.lengthUnit?c.kilometersLang:c.milesLang;var e=b.get("id");if(c.storeLimit===-1||c.storeLimit>60)var f=e+1;else var f=String.fromCharCode("A".charCodeAt(0)+e);var g={location:[a.extend(m,{markerid:e,marker:f,length:d,origin:h})]};return g}function r(){c.callbackModalOpen&&c.callbackModalOpen.call(this),a("#"+c.overlayDiv).hide()}function D(b){var e=q(b),f=d(e);a("#"+c.listDiv+" ul").append(f)}function E(a,b,d,e){new google.maps.MarkerImage("https://www.google.com/mapfiles/marker"+e+".png",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34));if(c.storeLimit===-1||c.storeLimit>60)var g=new google.maps.Marker({position:a,map:u,draggable:!1});else var g=new google.maps.Marker({position:a,map:u,icon:"https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+e+"|ff7171|000000",draggable:!1});return g}function F(b,d){var f=q(b),g=e(f);"left"===d?(x.setContent(g),x.open(b.get("map"),b)):google.maps.event.addListener(b,"click",function(){x.setContent(g),x.open(b.get("map"),b),a("#"+c.listDiv+" li").removeClass("list-focus"),markerId=b.get("id"),a("#"+c.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");var d=a("#"+c.listDiv),e=a("#"+c.listDiv+" li[data-markerid="+markerId+"]");a("#"+c.listDiv).animate({scrollTop:e.offset().top-d.offset().top+d.scrollTop()})})}var i,j,m={};if(c.slideMap===!0&&b.slideDown(),c.modalWindow===!0&&(c.callbackModalOpen&&c.callbackModalOpen.call(this),a("#"+c.overlayDiv).fadeIn(),a(document).on("click."+p,"#"+c.modalCloseIconDiv+", #"+c.overlayDiv,function(){r()}),a(document).on("click."+p,"#"+c.modalWindowDiv,function(a){a.stopPropagation()}),a(document).on("keyup."+p,function(a){27===a.keyCode&&r()})),c.fullMapStart===!0&&w===!0||0===c.zoomLevel)var s={mapTypeId:google.maps.MapTypeId.ROADMAP},t=new google.maps.LatLngBounds;else var s={zoom:c.zoomLevel,center:new google.maps.LatLng(f,g),mapTypeId:google.maps.MapTypeId.ROADMAP};var u=new google.maps.Map(document.getElementById(c.mapDiv),s);b.data("map",u);var x=new google.maps.InfoWindow;if(k=c.storeLimit===-1||l.length-1<c.storeLimit-1?l.length-1:c.storeLimit-1,c.originMarker===!0&&c.fullMapStart===!1)var y=new google.maps.LatLng(f,g),z=new google.maps.Marker({position:y,map:u,icon:"http://maps.google.com/mapfiles/ms/icons/"+c.originpinColor+"-dot.png",draggable:!1});for(var A=0;A<=k;A++){var C=(String.fromCharCode("A".charCodeAt(0)+A),new google.maps.LatLng(l[A].lat,l[A].lng));z=E(C,l[A].name,l[A].address,A),z.set("id",A),o[A]=z,(c.fullMapStart===!0&&w===!0||0===c.zoomLevel)&&t.extend(C),F(z)}(c.fullMapStart===!0&&w===!0||0===c.zoomLevel)&&u.fitBounds(t),a("#"+c.listDiv+" ul").empty(),a(o).each(function(a,b){var d=(String.fromCharCode("A".charCodeAt(0)+a),o[a]);D(d)}),a(document).on("click."+p,"#"+c.listDiv+" li",function(){var b=a(this).data("markerid"),d=o[b];a("#"+c.listDiv+" li").removeClass("list-focus"),a("#"+c.listDiv+" li[data-markerid="+b+"]").addClass("list-focus"),u.panTo(d.getPosition());var e="left";c.bounceMarker===!0?(d.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){d.setAnimation(null),F(d,e)},700)):F(d,e)}),a("#"+c.listDiv+" ul li:even").css("background","#"+c.listColor1),a("#"+c.listDiv+" ul li:odd").css("background","#"+c.listColor2)})}})})}var g,h,k,l=[],m=[],n=[],o=[],p="storeLocator";c.modalWindow===!0&&(b.wrap('<div id="'+c.overlayDiv+'"><div id="'+c.modalWindowDiv+'"><div id="'+c.modalContentDiv+'">'),a("#"+c.modalWindowDiv).prepend('<div id="'+c.modalCloseIconDiv+'"></div>'),a("#"+c.overlayDiv).hide()),c.slideMap===!0&&b.hide();var r={};"km"===c.lengthUnit?r.EarthRadius=6367:r.EarthRadius=3956,r.ToRadian=function(a){return a*(Math.PI/180)},r.DiffRadian=function(a,b){return r.ToRadian(b)-r.ToRadian(a)},r.CalcDistance=function(a,b,c,d,e){return 2*e*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(r.DiffRadian(a,c)/2),2)+Math.cos(r.ToRadian(a))*Math.cos(r.ToRadian(c))*Math.pow(Math.sin(r.DiffRadian(b,d)/2),2))))},s(),a(function(){function b(b){if(b.preventDefault(),c.maxDistance===!0){var d=a("#"+c.maxDistanceID).val();y(d)}else y()}c.noForm===!0?(a(document).on("click."+p,"#"+c.formContainerDiv+" #submit",function(a){b(a)}),a(document).on("keyup."+p,function(d){13===d.keyCode&&a("#"+c.inputID).is(":focus")&&b(d)})):a(document).on("submit."+p,"#"+c.formID,function(a){b(a)})})}var d,e,b=a(this);f()})}}(jQuery);
!function(e){e.fn.storeLocator=function(t){var a=e.extend({mapDiv:"map",listDiv:"loc-list",formContainerDiv:"form-container",formID:"user-location",inputID:"address",zoomLevel:4,pinColor:"fe7569",pinTextColor:"000000",lengthUnit:"m",storeLimit:60,distanceAlert:-1,dataType:"xml",dataLocation:"locations.xml",listColor1:"ffffff",listColor2:"eeeeee",originMarker:!1,originpinColor:"blue",bounceMarker:!0,slideMap:!0,modalWindow:!1,overlayDiv:"overlay",modalWindowDiv:"modal-window",modalContentDiv:"modal-content",modalCloseIconDiv:"close-icon",defaultLoc:!1,defaultLat:"",defaultLng:"",autoGeocode:!1,maxDistance:!1,maxDistanceID:"maxdistance",fullMapStart:!1,noForm:!1,loading:!1,loadingDiv:"loading-map",featuredLocations:!1,infowindowTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/xml-infowindow-description.html",listTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/xml-location-list-description.html",KMLinfowindowTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/kml-infowindow-description.html",KMLlistTemplatePath:"//www.daytranslations.com/wp-content/themes/bridge-child/js/jstemplate/kml-location-list-description.html",callbackBeforeSend:null,callbackComplete:null,callbackSuccess:null,callbackModalOpen:null,callbackModalClose:null,jsonpCallback:null,geocodeErrorAlert:"Geocode was not successful for the following reason: ",addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers"},t);return this.each(function(){function t(){"kml"===a.dataType?(e.get(a.KMLinfowindowTemplatePath,function(e){var t=e;n=Handlebars.compile(t)}),e.get(a.KMLlistTemplatePath,function(e){var t=e;i=Handlebars.compile(t),o()})):(e.get(a.infowindowTemplatePath,function(e){var t=e;n=Handlebars.compile(t)}),e.get(a.listTemplatePath,function(e){var t=e;i=Handlebars.compile(t),o()}))}function o(){function t(){v=[],w=[],k=[],D=[],e(document).off("click."+L,"#"+a.listDiv+" li")}function o(){if(a.defaultLoc===!0){var e=new s,t=new google.maps.LatLng(a.defaultLat,a.defaultLng);e.geocode(t,function(e){if(null!==e){var t=e.address;f(a.defaultLat,a.defaultLng,t)}else alert(a.addressErrorAlert)})}a.fullMapStart===!0&&f(),a.autoGeocode===!0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(d,m)}function r(){geocoder=new google.maps.Geocoder,this.geocode=function(e,t){geocoder.geocode({address:e},function(e,o){if(o===google.maps.GeocoderStatus.OK){var i={};i.latitude=e[0].geometry.location.lat(),i.longitude=e[0].geometry.location.lng(),t(i)}else alert(a.geocodeErrorAlert+o),t(null)})}}function s(){geocoder=new google.maps.Geocoder,this.geocode=function(e,t){geocoder.geocode({latLng:e},function(e,o){if(o===google.maps.GeocoderStatus.OK){if(e[0]){var i={};i.address=e[0].formatted_address,t(i)}}else alert(a.geocodeErrorAlert+o),t(null)})}}function c(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function d(e){var t=new s,o=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);t.geocode(o,function(t){if(null!==t){var o=t.address;f(e.coords.latitude,e.coords.longitude,o)}else alert(a.addressErrorAlert)})}function m(e){alert(a.autoGeocodeErrorAlert)}function u(t){var i=e("#"+a.inputID).val();if(""===i)o();else{var n=new r,l=i;n.geocode(l,function(e){null!==e?(p=e.latitude,g=e.longitude,f(p,g,i,t)):alert(a.addressErrorAlert)})}}function f(o,r,s,d){e(function(){google.maps.visualRefresh=!0;var m;m="kml"===a.dataType?"xml":a.dataType,e.ajax({type:"GET",url:a.dataLocation+("jsonp"===a.dataType?(a.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),dataType:m,jsonpCallback:"jsonp"===a.dataType?a.jsonpCallback:null,beforeSend:function(){a.callbackBeforeSend&&a.callbackBeforeSend.call(this),a.loading===!0&&e("#"+a.formContainerDiv).append('<div id="'+a.loadingDiv+'"></div>')},complete:function(t,o,i){a.callbackComplete&&a.callbackComplete.call(this,t,o,i),a.loading===!0&&e("#"+a.loadingDiv).remove()},success:function(m,u,f){function p(e){e.sort(function(e,t){return e.distance<t.distance?-1:e.distance>t.distance?1:0})}a.callbackSuccess&&a.callbackSuccess.call(this,m,u,f);var g,M=0;a.fullMapStart===!0&&e("#"+a.mapDiv).hasClass("mapOpen")===!1?g=!0:t(),e("#"+a.mapDiv).addClass("mapOpen"),"json"===a.dataType||"jsonp"===a.dataType?e.each(m,function(){var e,t,i={};for(e in this)t=this[e],"web"===e&&t&&(t=t.replace("http://","")),i[e]=t;if(i.distance||(i.distance=C.CalcDistance(o,r,i.lat,i.lng,C.EarthRadius)),a.maxDistance===!0&&g!==!0&&d){if(!(i.distance<d))return;v[M]=i}else v[M]=i;M++}):"kml"===a.dataType?e(m).find("Placemark").each(function(){var t={name:e(this).find("name").text(),lat:e(this).find("coordinates").text().split(",")[1],lng:e(this).find("coordinates").text().split(",")[0],description:e(this).find("description").text()};if(t.distance=C.CalcDistance(o,r,t.lat,t.lng,C.EarthRadius),a.maxDistance===!0&&g!==!0&&d){if(!(t.distance<d))return;v[M]=t}else v[M]=t;M++}):e(m).find("marker").each(function(){var t={name:e(this).attr("name"),lat:e(this).attr("lat"),lng:e(this).attr("lng"),address:e(this).attr("address"),address2:e(this).attr("address2"),city:e(this).attr("city"),state:e(this).attr("state"),postal:e(this).attr("postal"),country:e(this).attr("country"),phone:e(this).attr("phone"),email:e(this).attr("email"),web:e(this).attr("web"),hours1:e(this).attr("hours1"),hours2:e(this).attr("hours2"),hours3:e(this).attr("hours3"),category:e(this).attr("category"),featured:e(this).attr("featured")};if(t.web&&(t.web=t.web.replace("http://","")),t.distance=C.CalcDistance(o,r,t.lat,t.lng,C.EarthRadius),a.maxDistance===!0&&g!==!0&&d){if(!(t.distance<d))return;v[M]=t}else v[M]=t;M++}),p(v),a.featuredLocations===!0&&(w=e.grep(v,function(e,t){return"true"===e.featured}),k=e.grep(v,function(e,t){return"true"!==e.featured}),v=[],v=w.concat(k));var b="km"===a.lengthUnit?a.kilometersLang:a.milesLang;if(a.maxDistance===!0&&g!==!0&&d){if(void 0===v[0]||v[0].distance>d)return void alert(a.distanceErrorAlert+d+" "+b)}else-1!==a.distanceAlert&&v[0].distance>a.distanceAlert&&alert(a.distanceErrorAlert+a.distanceAlert+" "+b);e(function(){function t(e){for(w in v[e])k=v[e][w],"distance"===w&&(k=c(k,2)),C[w]=k}function d(o){t(o.get("id"));var i;i=C.distance<=1?"km"===a.lengthUnit?a.kilometerLang:a.mileLang:"km"===a.lengthUnit?a.kilometersLang:a.milesLang;var n=o.get("id");if(-1===a.storeLimit||a.storeLimit>60)var l=n+1;else var l=String.fromCharCode("A".charCodeAt(0)+n);var r={location:[e.extend(C,{markerid:n,marker:l,length:i,origin:s})]};return r}function m(){a.callbackModalOpen&&a.callbackModalOpen.call(this),e("#"+a.overlayDiv).hide()}function u(t){var o=d(t),n=i(o);e("#"+a.listDiv+" ul").append(n)}function f(e,t,o,i){if(new google.maps.MarkerImage("https://www.google.com/mapfiles/marker"+i+".png",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34)),-1===a.storeLimit||a.storeLimit>60)var n=new google.maps.Marker({position:e,map:y,draggable:!1,scrollwheel:!1});else var n=new google.maps.Marker({position:e,map:y,icon:"https://chart.googleapis.com/chart?chst=d_map_pin_letter&chld="+i+"|ff7171|000000",draggable:!1,scrollwheel:!1});return n}function p(t,o){var i=d(t),l=n(i);"left"===o?(T.setContent(l),T.open(t.get("map"),t)):google.maps.event.addListener(t,"click",function(){T.setContent(l),T.open(t.get("map"),t),e("#"+a.listDiv+" li").removeClass("list-focus"),markerId=t.get("id"),e("#"+a.listDiv+" li[data-markerid="+markerId+"]").addClass("list-focus");var o=e("#"+a.listDiv),i=e("#"+a.listDiv+" li[data-markerid="+markerId+"]");e("#"+a.listDiv).animate({scrollTop:i.offset().top-o.offset().top+o.scrollTop()})})}var w,k,C={};if(a.slideMap===!0&&l.slideDown(),a.modalWindow===!0&&(a.callbackModalOpen&&a.callbackModalOpen.call(this),e("#"+a.overlayDiv).fadeIn(),e(document).on("click."+L,"#"+a.modalCloseIconDiv+", #"+a.overlayDiv,function(){m()}),e(document).on("click."+L,"#"+a.modalWindowDiv,function(e){e.stopPropagation()}),e(document).on("keyup."+L,function(e){27===e.keyCode&&m()})),a.fullMapStart===!0&&g===!0||0===a.zoomLevel)var M={mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},b=new google.maps.LatLngBounds;else var M={zoom:a.zoomLevel,center:new google.maps.LatLng(o,r),scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};var y=new google.maps.Map(document.getElementById(a.mapDiv),M);l.data("map",y);var T=new google.maps.InfoWindow;if(h=-1===a.storeLimit||v.length-1<a.storeLimit-1?v.length-1:a.storeLimit-1,a.originMarker===!0&&a.fullMapStart===!1)var A=new google.maps.LatLng(o,r),x=new google.maps.Marker({position:A,map:y,icon:"http://maps.google.com/mapfiles/ms/icons/"+a.originpinColor+"-dot.png",draggable:!1,scrollwheel:!1});for(var I=0;h>=I;I++){var E=(String.fromCharCode("A".charCodeAt(0)+I),new google.maps.LatLng(v[I].lat,v[I].lng));x=f(E,v[I].name,v[I].address,I),x.set("id",I),D[I]=x,(a.fullMapStart===!0&&g===!0||0===a.zoomLevel)&&b.extend(E),p(x)}(a.fullMapStart===!0&&g===!0||0===a.zoomLevel)&&y.fitBounds(b),e("#"+a.listDiv+" ul").empty(),e(D).each(function(e,t){var a=(String.fromCharCode("A".charCodeAt(0)+e),D[e]);u(a)}),e(document).on("click."+L,"#"+a.listDiv+" li",function(){var t=e(this).data("markerid"),o=D[t];e("#"+a.listDiv+" li").removeClass("list-focus"),e("#"+a.listDiv+" li[data-markerid="+t+"]").addClass("list-focus"),y.panTo(o.getPosition());var i="left";a.bounceMarker===!0?(o.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){o.setAnimation(null),p(o,i)},700)):p(o,i)}),e("#"+a.listDiv+" ul li:even").css("background","#"+a.listColor1),e("#"+a.listDiv+" ul li:odd").css("background","#"+a.listColor2)})}})})}var p,g,h,v=[],w=[],k=[],D=[],L="storeLocator";a.modalWindow===!0&&(l.wrap('<div id="'+a.overlayDiv+'"><div id="'+a.modalWindowDiv+'"><div id="'+a.modalContentDiv+'">'),e("#"+a.modalWindowDiv).prepend('<div id="'+a.modalCloseIconDiv+'"></div>'),e("#"+a.overlayDiv).hide()),a.slideMap===!0&&l.hide();var C={};"km"===a.lengthUnit?C.EarthRadius=6367:C.EarthRadius=3956,C.ToRadian=function(e){return e*(Math.PI/180)},C.DiffRadian=function(e,t){return C.ToRadian(t)-C.ToRadian(e)},C.CalcDistance=function(e,t,a,o,i){return 2*i*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(C.DiffRadian(e,a)/2),2)+Math.cos(C.ToRadian(e))*Math.cos(C.ToRadian(a))*Math.pow(Math.sin(C.DiffRadian(t,o)/2),2))))},o(),e(function(){function t(t){if(t.preventDefault(),a.maxDistance===!0){var o=e("#"+a.maxDistanceID).val();u(o)}else u()}a.noForm===!0?(e(document).on("click."+L,"#"+a.formContainerDiv+" #submit",function(e){t(e)}),e(document).on("keyup."+L,function(o){13===o.keyCode&&e("#"+a.inputID).is(":focus")&&t(o)})):e(document).on("submit."+L,"#"+a.formID,function(e){t(e)})})}var i,n,l=e(this);t()})}}(jQuery);